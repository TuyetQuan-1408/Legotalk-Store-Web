<div class="content-wrapper">
    <!-- Sidebar lọc sản phẩm -->
    <div class="filter-sidebar">
        <div class="filters">
            <h3>PHÂN LOẠI</h3>
            <div id="categories">
                <label *ngFor="let category of categories">
                    <input type="checkbox" (change)="toggleCategory(category.Category_ID)" 
                           [checked]="selectedCategories.has(category.Category_ID)"> 
                    {{ category.Category_Name }}
                </label>
            </div>

            <h3>TÌNH TRẠNG</h3>
            <label>
                <input type="checkbox" (change)="toggleStock('in-stock')" [checked]="selectedStock.has('in-stock')"> 
                Còn hàng
            </label>
            <label>
                <input type="checkbox" (change)="toggleStock('out-of-stock')" [checked]="selectedStock.has('out-of-stock')"> 
                Hết hàng
            </label>

            <h3>GIÁ</h3>
            <label>
                <input type="checkbox" (change)="togglePrice('below-100k')" [checked]="selectedPrices.has('below-100k')">
                Dưới 100.000 VND
            </label>
            <label>
                <input type="checkbox" (change)="togglePrice('100k-499k')" [checked]="selectedPrices.has('100k-499k')">
                100.000 - 499.000 VND
            </label>
            <label>
                <input type="checkbox" (change)="togglePrice('500k-999k')" [checked]="selectedPrices.has('500k-999k')">
                500.000 - 999.000 VND
            </label>
            <label>
                <input type="checkbox" (change)="togglePrice('1m-1.999m')" [checked]="selectedPrices.has('1m-1.999m')">
                1.000.000 - 1.999.000 VND
            </label>
            <label>
                <input type="checkbox" (change)="togglePrice('2m-4.999m')" [checked]="selectedPrices.has('2m-4.999m')">
                2.000.000 - 4.999.000 VND
            </label>
            <label>
                <input type="checkbox" (change)="togglePrice('5m-9.999m')" [checked]="selectedPrices.has('5m-9.999m')">
                5.000.000 - 9.999.000 VND
            </label>
            <label>
                <input type="checkbox" (change)="togglePrice('above-10m')" [checked]="selectedPrices.has('above-10m')">
                Trên 10.000.000 VND
            </label>
        </div>
    </div>

    <!-- Danh sách sản phẩm -->
    <div class="main-content1">
        
        <div class="products" id="products">
            <div *ngFor="let product of filteredProducts" class="product">
                <a [routerLink]="['/product-detail', product.Product_ID]">
                    <img [src]="'http://localhost:3000/image/Products/' + product.Product_ID + '/1'">
                </a>                  
                <div class="info">
                    <div class="details">
                        <span *ngIf="product.Pieces">{{ product.Pieces }} PCS</span>
                        <span *ngIf="product.Weight">{{ product.Weight }}g</span>
                        <div class="rating">
                            <span>
                                <i class="fas fa-star" *ngIf="product.Rating"></i>
                                {{ product.Rating ? product.Rating.toFixed(1) : "Chưa có đánh giá" }}
                            </span>
                        </div>
                    </div>
                    <h3>
                        {{ product.Product_Name }}
                    </h3>
                    <p class="price">
                        <ng-container *ngIf="product.Second_Price && product.Second_Price !== 0; else noDiscount">
                          <ng-container *ngIf="product.Price">
                            <span style="text-decoration: line-through;">{{ product.Price | number }} VND</span><br/>
                            {{ product.Second_Price | number }} VND
                            (-{{ ((product.Price - product.Second_Price) / product.Price * 100) | number: '1.0-0' }}%)
                          </ng-container>
                          <ng-container *ngIf="!product.Price">
                            {{ product.Second_Price | number }} VND
                          </ng-container>
                        </ng-container>
                        <ng-template #noDiscount>
                          <ng-container *ngIf="product.Price; else contact">
                            {{ product.Price | number }} VND
                          </ng-container>
                          <ng-template #contact>
                            Liên hệ
                          </ng-template>
                        </ng-template>
                    </p>
                         
                    <div class="buttons">
                        <button class="add-to-cart" (click)="addToCart(product.Product_ID)">Thêm vào giỏ hàng</button>
                        <button class="buy-now" (click)="addToFavourite(product.Product_ID)"
                                >
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
</div>
